<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>55Guh</title>
<link href="https://fonts.googleapis.com/css2?family=Oswald:wght@700&display=swap" rel="stylesheet">
<style>
    body {
        font-family: 'Oswald', sans-serif;
        background: #f5f5f5;
        margin: 0;
        padding: 20px;
    }
    h1 {
        text-align: center;
        margin-bottom: 20px;
    }
    #top-bar {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
        font-size: 14px;
        color: #333;
    }
    #search-container {
        display: flex;
        margin: 10px 0;
    }
    #search {
        flex: 1;
        padding: 6px;
        font-size: 14px;
    }
    #search-btn {
        padding: 6px 12px;
        font-size: 14px;
        margin-left: 5px;
        cursor: pointer;
    }
    #breadcrumbs {
        margin: 10px 0;
        font-size: 14px;
    }
    ul {
        list-style: none;
        padding: 0;
    }
    li {
        padding: 5px 0;
    }
    a {
        text-decoration: none;
        color: #0066cc;
    }
    a:hover {
        text-decoration: underline;
    }
</style>
</head>
<body>
    <div id="top-bar">
        <div id="user-agent"></div>
        <div id="platform"></div>
    </div>
    <h1>55Guh</h1>

    <div id="breadcrumbs"></div>

    <div id="search-container">
        <input id="search" type="text" placeholder="Search (* = wildcard)">
        <button id="search-btn">Enter</button>
    </div>

    <ul id="file-list"></ul>

<script>
const ua = navigator.userAgent;
const platform = navigator.platform;
document.getElementById("user-agent").textContent = ua;
document.getElementById("platform").textContent = platform;

const params = new URLSearchParams(window.location.search);
let repo = params.get("repo") || "55guh.github.io";
let path = params.get("path") || "";

// Breadcrumb navigation
function renderBreadcrumbs() {
    const bc = document.getElementById("breadcrumbs");
    const parts = path.split("/").filter(p => p);
    let html = `<a href="?repo=${repo}">🏠 ${repo}</a>`;
    let accum = "";
    for (let i = 0; i < parts.length; i++) {
        accum += (i > 0 ? "/" : "") + parts[i];
        html += " / " + `<a href="?repo=${repo}&path=${accum}">${parts[i]}</a>`;
    }
    bc.innerHTML = html;
}

// File type → emoji mapping
function getEmoji(filename) {
    const ext = filename.split(".").pop().toLowerCase();
    if (["exe","msi","dmg"].includes(ext)) return "💻";
    if (["apk","ipa"].includes(ext)) return "📱";
    if (["mp4","webm","mov","avi","mkv"].includes(ext)) return "📹";
    if (ext === "zip" || ext === "rar" || ext === "7z") return "📦";
    return "📄";
}

// Load repo contents
async function loadFiles() {
    renderBreadcrumbs();
    let apiUrl = `https://api.github.com/repos/55guh/${repo}/contents/${path}`;
    const res = await fetch(apiUrl);
    if (!res.ok) {
        document.getElementById("file-list").innerHTML = "<li>❌ Error loading repo</li>";
        return;
    }
    let data = await res.json();

    // Folders first
    data.sort((a, b) => a.type.localeCompare(b.type));

    let list = "";
    if (path) {
        const parent = path.split("/").slice(0, -1).join("/");
        list += `<li>⬅️ <a href="?repo=${repo}&path=${parent}">Go Back</a></li>`;
    }

    data.forEach(item => {
        if (item.name === "index.html") return; // skip index.html
        if (item.type === "dir") {
            list += `<li>📁 <a href="?repo=${repo}&path=${path ? path + "/" : ""}${item.name}">${item.name}</a></li>`;
        } else {
            const url = `https://55guh.github.io/${repo}/${path ? path + "/" : ""}${item.name}`;
            list += `<li>${getEmoji(item.name)} <a href="${url}" target="_blank">${item.name}</a></li>`;
        }
    });

    document.getElementById("file-list").innerHTML = list;
}

// Search function
function runSearch() {
    const query = document.getElementById("search").value.toLowerCase();
    const items = document.querySelectorAll("#file-list li");
    items.forEach(li => {
        const text = li.innerText.toLowerCase();
        if (!query || query === "*") {
            li.style.display = "";
        } else {
            li.style.display = text.includes(query) ? "" : "none";
        }
    });
}

// Hook up search
document.getElementById("search-btn").addEventListener("click", runSearch);
document.getElementById("search").addEventListener("keydown", e => {
    if (e.key === "Enter") runSearch();
    if (e.key === "Backspace") e.stopPropagation(); // keep backspace working
});

// Global backspace → go up a directory
document.addEventListener("keydown", e => {
    if (document.activeElement === document.getElementById("search")) return;
    if (e.key === "Backspace") {
        e.preventDefault();
        const parent = path.split("/").slice(0, -1).join("/");
        window.location.href = `?repo=${repo}&path=${parent}`;
    }
});

loadFiles();
</script>
</body>
</html>
