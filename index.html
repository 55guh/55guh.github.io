<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>55Guh</title>
  <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Oswald', sans-serif;
      margin: 20px;
      background: #f6f8fa;
      color: #24292f;
    }
    h1 { font-size: 2em; }
    h2 { font-size: 1.2em; margin-top: 0; }
    ul { list-style: none; padding: 0; }
    li { margin: 6px 0; }
    a { text-decoration: none; color: #0366d6; }
    a:hover { text-decoration: underline; }
    .breadcrumbs { margin: 10px 0; }
    .breadcrumbs a { margin-right: 5px; }
  </style>
</head>
<body>
  <h1>55Guh</h1>
  <h2 id="date"></h2>
  <div class="breadcrumbs" id="breadcrumbs"></div>
  <div id="repo-list"></div>

<script>
const user = "55guh";
let currentRepo = null;
let currentPath = "";

// Date
document.getElementById("date").textContent = new Date().toLocaleDateString(
  "en-US",
  { year: "numeric", month: "long", day: "numeric" }
);

// List repos
async function listRepos() {
  const res = await fetch(`https://api.github.com/users/${user}/repos`);
  const repos = await res.json();
  const list = document.getElementById("repo-list");
  list.innerHTML = "<h3>Select a repo:</h3><ul>" + repos.map(r =>
    `<li>ðŸ“¦ <a href="#" onclick="openRepo('${r.name}')">${r.name}</a></li>`
  ).join("") + "</ul>";
}

async function openRepo(repo, path = "") {
  currentRepo = repo;
  currentPath = path;
  updateBreadcrumbs();
  const url = `https://api.github.com/repos/${user}/${repo}/contents/${path}`;
  const res = await fetch(url);
  const items = await res.json();
  const list = document.getElementById("repo-list");
  if (Array.isArray(items)) {
    let dirs = items.filter(i => i.type === "dir");
    let files = items.filter(i => i.type === "file" && i.name !== "index.html");
    list.innerHTML = `<h3>Browsing: ${repo}/${path}</h3>
      <button onclick="goBack()">â¬… Go Back</button>
      <p><a href="${buildZipUrl(repo)}">ðŸ“¦ Download Entire Repo as ZIP</a></p>
      <ul>` + dirs.map(d =>
        `<li>ðŸ“‚ <a href="#" onclick="openRepo('${repo}', '${path}${d.name}/')">${d.name}</a></li>`
      ).join("") +
      files.map(f =>
        `<li>ðŸ“„ <a href="#" onclick="openFile('${repo}', '${path}${f.name}')">${f.name}</a></li>`
      ).join("") + "</ul>";
  }
}

function goBack() {
  if (!currentPath) {
    listRepos();
  } else {
    const up = currentPath.split("/").slice(0, -2).join("/") + "/";
    openRepo(currentRepo, up);
  }
}

// Build download URL for a single file
function buildDownloadUrl(repo, filepath) {
  if (repo === "55guh.github.io") {
    return `https://55guh.github.io/file/${filepath}`;
  } else {
    return `https://55guh.github.io/repo/${repo}/file/${filepath}`;
  }
}

// Build ZIP URL for a whole repo
function buildZipUrl(repo) {
  if (repo === "55guh.github.io") {
    return `https://55guh.github.io/file.zip`;
  } else {
    return `https://55guh.github.io/repo/${repo}/file.zip`;
  }
}

async function openFile(repo, filepath) {
  const url = buildDownloadUrl(repo, filepath);

  const a = document.createElement("a");
  a.href = url;
  a.download = filepath.split("/").pop(); // file name only
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
}

function updateBreadcrumbs() {
  let parts = currentPath.split("/").filter(p => p);
  let crumbHTML = `<a href="#" onclick="listRepos()">Repos</a> / <a href="#" onclick="openRepo('${currentRepo}')">${currentRepo}</a>`;
  let built = "";
  parts.forEach((p, i) => {
    built += p + "/";
    crumbHTML += ` / <a href="#" onclick="openRepo('${currentRepo}', '${built}')">${p}</a>`;
  });
  document.getElementById("breadcrumbs").innerHTML = crumbHTML;
}

listRepos();
</script>
</body>
</html>
