<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>55Guh</title>
<link href="https://fonts.googleapis.com/css2?family=Oswald:wght@700&display=swap" rel="stylesheet">
<style>
  body {
    font-family: 'Oswald', sans-serif;
    font-weight: 700;
    padding: 20px;
    background: #f8f8f8;
  }
  h1 {
    font-size: 2em;
    margin-bottom: 10px;
  }
  #path {
    margin: 8px 0 12px;
    opacity: .8;
  }
  ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }
  li {
    padding: 6px 0;
  }
  a {
    color: #0366d6;
    text-decoration: none;
    word-break: break-word;
  }
  a:hover {
    text-decoration: underline;
  }
  .back {
    display: inline-block;
    margin-bottom: 10px;
    padding: 5px 10px;
    background: #ddd;
    border-radius: 4px;
    color: black;
  }
  .row {
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .icon {
    width: 1.4em;
  }
</style>
</head>
<body>
<h1>55Guh</h1>
<div id="path"></div>
<ul id="file-list"></ul>

<script>
const repoOwner = "55guh";
const repoName  = "55guh.github.io";
let currentPath = "";

// Read path from URL query
const urlParams = new URLSearchParams(window.location.search);
if (urlParams.has("path")) {
  currentPath = decodeURIComponent(urlParams.get("path"));
}

// Sets of extensions for special icons
const pcExts  = new Set([
  "exe","msi","msp","msix","msixbundle","appx","appxbundle",
  "dmg","pkg","deb","rpm",
  "sh","bash","run","bin","elf","cmd","bat","ps1","msu","iso"
]);
const phoneExts = new Set(["apk","aab","ipa"]);

// Decide icon based on file
function getIcon(file) {
  if (file.type === "dir") return "üìÅ";
  const name = file.name.toLowerCase();
  const ext  = name.includes(".") ? name.split(".").pop() : "";
  if (phoneExts.has(ext)) return "üì±";
  if (pcExts.has(ext))    return "üñ•Ô∏è";
  return "üìÑ";
}

async function fetchFiles(path = "") {
  const apiUrl = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/${path}`;
  const res = await fetch(apiUrl);
  if (!res.ok) {
    document.getElementById('file-list').innerHTML = `<li>Error loading files</li>`;
    return;
  }
  let files = await res.json();

  // Sort: folders first, then files (alphabetical)
  files.sort((a, b) => (a.type === b.type ? a.name.localeCompare(b.name) : a.type === "dir" ? -1 : 1));

  let html = "";

  if (path) {
    html += `<li><a href="#" class="back" onclick="goBack(event)">‚¨Ö Go Back</a></li>`;
  }

  files.forEach(file => {
    if (file.name.toLowerCase() === "index.html") return; // exclude index.html

    const displayPath = path ? `${path}/${file.name}` : file.name;
    const icon = getIcon(file);

    if (file.type === "dir") {
      html += `<li class="row"><span class="icon">${icon}</span>
                 <a href="#" onclick="openFolder('${displayPath}', event)">${file.name}</a>
               </li>`;
    } else {
      const fileUrl = `https://55guh.github.io/${displayPath}`;
      html += `<li class="row"><span class="icon">${icon}</span>
                 <a href="${fileUrl}" target="_blank" rel="noopener noreferrer">${file.name}</a>
               </li>`;
    }
  });

  document.getElementById('file-list').innerHTML = html;
  document.getElementById('path').textContent = `/${path}`;

  // Update the URL so it can be shared
  const newUrl = path ? `?path=${encodeURIComponent(path)}` : "";
  history.replaceState(null, "", newUrl);
}

function openFolder(folderPath, e) {
  e.preventDefault();
  currentPath = folderPath;
  fetchFiles(currentPath);
}

function goBack(e) {
  e.preventDefault();
  const parts = currentPath.split('/').filter(Boolean);
  parts.pop();
  currentPath = parts.join('/');
  fetchFiles(currentPath);
}

// Initial load
fetchFiles(currentPath);
</script>
</body>
</html>
