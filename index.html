<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>55Guh</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Oswald:wght@500;700&display=swap" rel="stylesheet">
<style>
    body {
        font-family: 'Oswald', sans-serif;
        background: #f5f5f5;
        color: #222;
        margin: 0; padding: 0;
    }
    header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: #222;
        color: #fff;
        padding: 10px;
        font-size: 14px;
    }
    h1 {
        text-align: center;
        margin: 10px;
    }
    #breadcrumbs {
        font-size: 14px;
        margin: 10px;
    }
    #breadcrumbs a { color: #0073e6; text-decoration: none; }
    #breadcrumbs a:hover { text-decoration: underline; }
    #file-list a {
        display: block;
        padding: 6px;
        text-decoration: none;
        color: #0073e6;
    }
    #file-list a:hover, #file-list a.active {
        background: #ddd;
    }
    .viewer {
        margin: 15px;
        padding: 10px;
        background: #fff;
        border: 1px solid #ccc;
    }
    textarea {
        width: 100%;
        height: 400px;
        font-family: monospace;
    }
    video, img {
        max-width: 100%;
    }
    #search-bar {
        margin: 10px;
        padding: 5px;
        width: calc(100% - 20px);
    }
    .mobile { font-size: 16px; }
    noscript {
        background: red;
        color: white;
        display: block;
        text-align: center;
        padding: 10px;
        font-weight: bold;
    }
</style>
</head>
<body>
<noscript>âš  JavaScript is required for this site to work properly.</noscript>

<header>
    <div>User Agent: <span id="ua"></span></div>
    <div>Platform: <span id="platform"></span></div>
</header>

<h1>55Guh</h1>

<div id="breadcrumbs"></div>
<input type="text" id="search-bar" placeholder="Search files (* = wildcard for all)">

<div id="file-list"></div>

<div id="viewer" class="viewer"></div>

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

<script>
const org = "55guh";
let currentRepo = "55guh.github.io";
let currentPath = "";
let token = localStorage.getItem("gh_token") || "";

document.getElementById("ua").innerText = navigator.userAgent;
document.getElementById("platform").innerText = navigator.platform;

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Breadcrumbs
function renderBreadcrumbs(repo, path) {
    const bc = document.getElementById("breadcrumbs");
    const parts = path ? path.split("/") : [];
    let html = `<a href="?repo=${repo}">${repo}</a>`;
    let cumulative = "";
    parts.forEach((p, i) => {
        cumulative += (i ? "/" : "") + p;
        html += ` / <a href="?repo=${repo}&path=${cumulative}">${p}</a>`;
    });
    bc.innerHTML = html;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Load repo contents
async function loadRepo(repo, path="") {
    currentRepo = repo;
    currentPath = path;

    renderBreadcrumbs(repo, path);

    let url = `https://api.github.com/repos/${org}/${repo}/contents/${path}`;
    let res = await fetch(url);
    if (!res.ok) { document.getElementById("file-list").innerHTML = "<p>Failed to load.</p>"; return; }
    let data = await res.json();

    // filter binary files
    const binaryExt = /\.(exe|dmg|msi|apk|ipa|zip|tar|gz|7z)$/i;

    // sort folders first
    data.sort((a,b) => a.type === b.type ? a.name.localeCompare(b.name) : (a.type==="dir"?-1:1));

    let container = document.getElementById("file-list");
    container.innerHTML = "";

    // Back link
    if (path) {
        let parent = path.split("/").slice(0, -1).join("/");
        container.innerHTML += `<a href="?repo=${repo}&path=${parent}">â¬… Go Back</a>`;
    }

    // Search filter
    const searchVal = document.getElementById("search-bar").value.toLowerCase();
    const regex = new RegExp("^" + searchVal.replace("*",".*") + "$");

    data.forEach(file => {
        if (searchVal && !regex.test(file.name.toLowerCase())) return;
        let icon = file.type === "dir" ? "ğŸ“ " : "ğŸ“„ ";
        if (/\.(mp4|webm)$/i.test(file.name)) icon = "ğŸ¥ ";
        if (/\.(png|jpg|jpeg|gif)$/i.test(file.name)) icon = "ğŸ–¼ï¸ ";
        if (/\.(exe|dmg|msi)$/i.test(file.name)) icon = "ğŸ’» ";
        if (/\.(apk|ipa)$/i.test(file.name)) icon = "ğŸ“± ";

        if (file.type === "dir") {
            container.innerHTML += `<a href="?repo=${repo}&path=${path ? path + "/" : ""}${file.name}">${icon}${file.name}</a>`;
        } else if (!binaryExt.test(file.name)) {
            container.innerHTML += `<a href="#" onclick="viewFile('${repo}','${path}','${file.name}')">${icon}${file.name}</a>`;
        }
    });
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// File viewer
async function viewFile(repo, path, file) {
    const fileUrl = `https://raw.githubusercontent.com/${org}/${repo}/main/${path ? path+"/":""}${file}`;
    const ext = file.split(".").pop().toLowerCase();
    const viewer = document.getElementById("viewer");
    viewer.innerHTML = `<h3>${file}</h3>`;

    if (["png","jpg","jpeg","gif"].includes(ext)) {
        viewer.innerHTML += `<img src="${fileUrl}" alt="${file}">`;
    } else if (["mp4","webm"].includes(ext)) {
        viewer.innerHTML += `<video controls src="${fileUrl}"></video>`;
    } else if (ext === "md") {
        let txt = await (await fetch(fileUrl)).text();
        viewer.innerHTML += marked.parse(txt);
    } else if (["html","js","json","txt","css"].includes(ext)) {
        let txt = await (await fetch(fileUrl)).text();
        viewer.innerHTML += `<textarea readonly>${txt}</textarea>`;
    } else {
        viewer.innerHTML += `<p>Preview not available.</p>`;
    }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Keyboard navigation
let selectedIndex = 0;
document.addEventListener("keydown", e => {
    let links = [...document.querySelectorAll("#file-list a")];
    if (!links.length) return;
    if (e.key === "ArrowDown") {
        selectedIndex = (selectedIndex+1) % links.length;
    } else if (e.key === "ArrowUp") {
        selectedIndex = (selectedIndex-1+links.length) % links.length;
    } else if (e.key === "Enter") {
        links[selectedIndex].click();
    }
    links.forEach(l => l.classList.remove("active"));
    links[selectedIndex].classList.add("active");
});

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Search bar live update
document.getElementById("search-bar").addEventListener("input", () => {
    loadRepo(currentRepo, currentPath);
});

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Auto update checker (every 30s)
setInterval(() => {
    loadRepo(currentRepo, currentPath);
}, 30000);

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Init
const params = new URLSearchParams(location.search);
loadRepo(params.get("repo") || "55guh.github.io", params.get("path") || "");
</script>

</body>
</html>
