<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>55Guh</title>
<link href="https://fonts.googleapis.com/css2?family=Oswald:wght@700&display=swap" rel="stylesheet">
<style>
    body {
        font-family: 'Oswald', sans-serif;
        font-weight: 700;
        background: #f5f5f5;
        color: #222;
        padding: 20px;
    }
    h1 {
        font-size: 2em;
        margin-bottom: 10px;
    }
    a {
        display: block;
        padding: 4px 0;
        text-decoration: none;
        color: #0073e6;
    }
    a:hover {
        text-decoration: underline;
    }
    .folder {
        font-weight: bold;
    }
    .back {
        margin-bottom: 15px;
        display: inline-block;
    }
    .clock {
        margin: 15px 0;
        font-size: 1.1em;
        color: #444;
    }
</style>
</head>
<body>
<h1>55Guh</h1>
<div id="clock" class="clock"></div>
<div id="file-list"></div>

<script>
async function listRepos() {
    const res = await fetch("https://api.github.com/users/55guh/repos");
    const repos = await res.json();
    const container = document.getElementById("file-list");
    container.innerHTML = "<h2>Select a repository:</h2>";
    repos.forEach(repo => {
        container.innerHTML += `<a class="folder" href="?repo=${repo.name}">üìÅ ${repo.name}</a>`;
    });
}

async function loadRepo(repo, path = "") {
    const apiUrl = `https://api.github.com/repos/55guh/${repo}/contents/${path}`;
    const res = await fetch(apiUrl);
    if (!res.ok) {
        document.getElementById("file-list").innerHTML = `<p>Failed to load.</p>`;
        return;
    }
    let data = await res.json();

    const container = document.getElementById("file-list");
    container.innerHTML = "";

    if (path) {
        const parentPath = path.split("/").slice(0, -1).join("/");
        const backUrl = parentPath ? `?repo=${repo}&path=${parentPath}` : `?repo=${repo}`;
        container.innerHTML += `<a href="${backUrl}" class="back">‚¨Ö Go Back</a>`;
    } else {
        container.innerHTML += `<a href="?" class="back">‚¨Ö Back to Repos</a>`;
    }

    // Remove index.html
    data = data.filter(file => file.name !== "index.html");

    // Sort: folders first
    data.sort((a, b) => {
        if (a.type === b.type) return a.name.localeCompare(b.name);
        return a.type === "dir" ? -1 : 1;
    });

    data.forEach(file => {
        let icon = "";
        const lowerName = file.name.toLowerCase();

        if (/\.(exe|dmg|msi|bat|sh)$/.test(lowerName)) {
            icon = "üíª ";
        } else if (/\.(apk|ipa)$/.test(lowerName)) {
            icon = "üì± ";
        } else if (/\.(mp4|mov|avi|mkv|webm)$/.test(lowerName)) {
            icon = "üé• ";
        } else if (file.type === "dir") {
            icon = "üìÅ ";
        }

        if (file.type === "dir") {
            container.innerHTML += `<a class="folder" href="?repo=${repo}&path=${path ? path + "/" : ""}${file.name}">${icon}${file.name}</a>`;
        } else {
            // ‚úÖ FIX: Use 55guh.github.io instead of raw.githubusercontent
            const fileUrl = `https://55guh.github.io/${repo}/${path ? path + "/" : ""}${file.name}`;
            container.innerHTML += `<a href="${fileUrl}" target="_blank">${icon}${file.name}</a>`;
        }
    });
}

// Clock + date
function updateClock() {
    const now = new Date();
    const options = { year: "numeric", month: "long", day: "numeric" };
    let formatted = now.toLocaleDateString("en-US", options);

    // add "st", "nd", "rd", "th"
    const day = now.getDate();
    let suffix = "th";
    if (day % 10 === 1 && day !== 11) suffix = "st";
    else if (day % 10 === 2 && day !== 12) suffix = "nd";
    else if (day % 10 === 3 && day !== 13) suffix = "rd";
    formatted = formatted.replace(/\d+/, day + suffix);

    document.getElementById("clock").textContent = formatted;
}
setInterval(updateClock, 1000);
updateClock();

// Init
const urlParams = new URLSearchParams(window.location.search);
const repo = urlParams.get("repo");
const currentPath = urlParams.get("path") || "";

if (repo) {
    loadRepo(repo, currentPath);
} else {
    listRepos();
}
</script>
</body>
</html>
