<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>55Guh</title>
  <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Oswald', sans-serif;
      margin: 20px;
      background: #f6f8fa;
      color: #24292f;
    }
    h1 { font-size: 2em; }
    h2 { font-size: 1.2em; margin-top: 0; }
    ul { list-style: none; padding: 0; }
    li { margin: 6px 0; }
    a { text-decoration: none; color: #0366d6; }
    a:hover { text-decoration: underline; }
    .breadcrumbs { margin: 10px 0; }
    .breadcrumbs a { margin-right: 5px; }
    .file-viewer { margin-top: 20px; border: 1px solid #ddd; padding: 10px; background: #fff; }
    .toolbar { margin-top: 10px; }
    button { margin: 2px; }
    canvas { max-width: 100%; display: block; margin-top: 10px; }
    #downloadBtn { margin-top: 10px; display: inline-block; }
  </style>
</head>
<body>
  <h1>55Guh</h1>
  <h2 id="date"></h2>
  <div class="breadcrumbs" id="breadcrumbs"></div>
  <div id="repo-list"></div>
  <div class="file-viewer" id="file-viewer" style="display:none;">
    <button onclick="goBack()">â¬… Go Back</button>
    <div id="viewer-content"></div>
    <a id="downloadBtn" href="#" download style="display:none;">â¬‡ Download File</a>
  </div>

<script>
const user = "55guh";
let currentRepo = null;
let currentPath = "";

// Date
document.getElementById("date").textContent = new Date().toLocaleDateString(
  "en-US",
  { year: "numeric", month: "long", day: "numeric" }
);

// List repos
async function listRepos() {
  const res = await fetch(`https://api.github.com/users/${user}/repos`);
  const repos = await res.json();
  const list = document.getElementById("repo-list");
  list.innerHTML = "<h3>Select a repo:</h3><ul>" + repos.map(r =>
    `<li>ðŸ“¦ <a href="#" onclick="openRepo('${r.name}')">${r.name}</a></li>`
  ).join("") + "</ul>";
}

async function openRepo(repo, path = "") {
  currentRepo = repo;
  currentPath = path;
  updateBreadcrumbs();
  const url = `https://api.github.com/repos/${user}/${repo}/contents/${path}`;
  const res = await fetch(url);
  const items = await res.json();
  const list = document.getElementById("repo-list");
  if (Array.isArray(items)) {
    let dirs = items.filter(i => i.type === "dir");
    let files = items.filter(i => i.type === "file" && i.name !== "index.html");
    list.innerHTML = `<h3>Browsing: ${repo}/${path}</h3>
      <button onclick="goBack()">â¬… Go Back</button>
      <ul>` + dirs.map(d =>
        `<li>ðŸ“‚ <a href="#" onclick="openRepo('${repo}', '${path}${d.name}/')">${d.name}</a></li>`
      ).join("") +
      files.map(f =>
        `<li>ðŸ“„ <a href="#" onclick="openFile('${repo}', '${path}${f.name}')">${f.name}</a></li>`
      ).join("") + "</ul>";
  }
}

function goBack() {
  if (!currentPath) {
    listRepos();
  } else {
    const up = currentPath.split("/").slice(0, -2).join("/") + "/";
    openRepo(currentRepo, up);
  }
}

async function openFile(repo, filepath) {
  const url = `https://raw.githubusercontent.com/${user}/${repo}/main/${filepath}`;
  const viewer = document.getElementById("file-viewer");
  const contentDiv = document.getElementById("viewer-content");
  const downloadBtn = document.getElementById("downloadBtn");
  viewer.style.display = "block";
  contentDiv.innerHTML = "Loading...";

  try {
    const res = await fetch(url);
    const blob = await res.blob();

    // Decide if binary or text
    if (blob.type.startsWith("image/")) {
      const imgURL = URL.createObjectURL(blob);
      contentDiv.innerHTML = `<img id="img" src="${imgURL}" style="max-width:100%;">`;
      downloadBtn.style.display = "inline-block";
      downloadBtn.href = imgURL;
      downloadBtn.download = filepath.split("/").pop();
    } else if (blob.type.startsWith("video/")) {
      const vidURL = URL.createObjectURL(blob);
      contentDiv.innerHTML = `<video controls src="${vidURL}" style="max-width:100%"></video>`;
      downloadBtn.style.display = "inline-block";
      downloadBtn.href = vidURL;
      downloadBtn.download = filepath.split("/").pop();
    } else if (blob.type.startsWith("text/") || filepath.endsWith(".md")) {
      const text = await res.text();
      contentDiv.innerHTML = `<pre>${escapeHtml(text)}</pre>`;
      downloadBtn.style.display = "inline-block";
      downloadBtn.href = url;
      downloadBtn.download = filepath.split("/").pop();
    } else {
      contentDiv.innerHTML = `<p>This file type cannot be displayed.</p>`;
      downloadBtn.style.display = "inline-block";
      downloadBtn.href = url;
      downloadBtn.download = filepath.split("/").pop();
    }
  } catch {
    contentDiv.innerHTML = `<p>Error loading file.</p>`;
    downloadBtn.style.display = "none";
  }
}

function updateBreadcrumbs() {
  let parts = currentPath.split("/").filter(p => p);
  let crumbHTML = `<a href="#" onclick="listRepos()">Repos</a> / <a href="#" onclick="openRepo('${currentRepo}')">${currentRepo}</a>`;
  let built = "";
  parts.forEach((p, i) => {
    built += p + "/";
    crumbHTML += ` / <a href="#" onclick="openRepo('${currentRepo}', '${built}')">${p}</a>`;
  });
  document.getElementById("breadcrumbs").innerHTML = crumbHTML;
}

function escapeHtml(text) {
  let div = document.createElement("div");
  div.innerText = text;
  return div.innerHTML;
}

listRepos();
</script>
</body>
</html>
